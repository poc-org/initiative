<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="API Demo" scrolling="true">
    <Require feature="opensocial-templates"/>
    <Require feature="opensocial-data"/>
    <Require feature="views"/>
    <Require feature="dynamic-height"/>
	  <Require feature="osapi"/>
  </ModulePrefs>
  <Content type="html" view="home">
  <![CDATA[

    <script xmlns:os="http://ns.opensocial.org/2008/markup" type="text/os-data">
      /* here we can use data passed from the gadget to make an API call before the microapp is rendered. You must replace "your.sabacloud.com" with your site url. */

      <os:HttpRequest key="profile_data" href="https://dxc-itg-api.sabacloud.com/v1/people/${ViewParams.sabaContext.userId}:(socialProfile,coreProfile,lname,fname,email,is_manager,person_no,customValues)?SabaCertificate=${ViewParams.sabaContext.certificate}"/>

      <os:HttpRequest key="enrollments_data" href="https://dxc-itg-api.sabacloud.com/v1/enrollment?SabaCertificate=${ViewParams.sabaContext.certificate}"/>

      <os:HttpRequest key="transcript_data" href="https://dxc-itg-api.sabacloud.com/v1/transcripts?SabaCertificate=${ViewParams.sabaContext.certificate}"/>

/* Added by Shakeel for the Job Role data for testing */
     <os:HttpRequest key="jobrole_data" href="https://dxc-itg-api.sabacloud.com/v1/role/roles000000000003140?includeassociation=true&SabaCertificate=${ViewParams.sabaContext.apiCertificate}"/>
    </script>

    <style type="text/css">
      /* you could put a stylesheet in here too or link one in */

      /* you can also link in javascript as you would a regular web page rather than coding it inline */
    </style>
	<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js' type='text/javascript'></script>
	
    <script type="text/javascript">

      function init(){
        var profileData = opensocial.data.DataContext.getDataSet('profile_data'), // these 3 lines bring in the variables from above containing the API data
            learningData = opensocial.data.DataContext.getDataSet('enrollments_data'),
            transData = opensocial.data.DataContext.getDataSet('transcript_data'),

            jobroleData = opensocial.data.DataContext.getDataSet('jobrole_data'), // Added by Shakeel for JobRole Data testing 
            viewData = gadgets.views.getParams(); //this brings in the ViewParams data passed from Saba
            //div1 = document.getElementById("1"),
            //div2 = document.getElementById("2"),
            //div3 = document.getElementById("3"),
            //div4 = document.getElementById("4"); // added by shakeel for Jobrole data testing

            //console.log(profileData.content.contact_email);
            //debug json data
            //console.log(viewData);
            //console.log(profileData);
      }
	  gadgets.util.registerOnLoadHandler(init);
	   var sabaCertificate = "4E41335431534E42303038312D33313336333136313332333436333330333936323338354532333545353735333546343134343444343934453545323335453445343133333534333135333445343233303330333833313545323335453635364535463535353335453233354535333631363236313545323335453244333135453233354532343431343234303330324330323134374332333344364231333142313030323742323531333341383344453333433037423543353938333032313431324245414345443243463630423241373133343943433638364436394630443533323242384544";
       var employeeID = "emplo000000000104546";
       var userName = "22014213";
       var urlAPIRole = "https://dxc-itg-api.sabacloud.com/v1/role";
       var varRoleID;

       $(function () {       
			 $("#btnRoleSubmit").click(function () {
                           
               submitGetRole();
               //alert(test);
               //var test = OnSuccess(response, status);
               //alert(test+'Shakeel');
                //submitEmpProfileListQuery();
			
           });



           $("#btnRoleCancel").click(function () {
               document.getElementById("searchRoleParam").value = ""
           });

           $("#btnRoleBack").click(function () {
               divConfirmPreviou = document.getElementById('divConfirmPreviou');
               divConfirmPreviou.style.display = "none";

           });


       });

       function submitRoleQuery() {
           $("#result").empty();
           var inputParam = {};
           inputParam.name = $.trim($("[id*=searchRoleParam]").val());           
		   alert(inputParam.name)
           var urlAPIRole_new = urlAPIRole+"?q=(name==" + inputParam.name  + ")&SabaCertificate=" + sabaCertificate
           var payLoad = '';
		alert(urlAPIRole_new);
document.getElementById('labelAPI').value = urlAPIRole_new
           $.ajax({
                type: "GET",
               url: urlAPIRole_new,
               //data: jobRoleSearchURLParam,
               contentType: "application/json; charset=utf-8",   //contentType is for request
               //dataType: "json",   //datatype is for response, this has problem with base64 string; could be json, html, text, etc
               dataType: "text",
		async: true,
               success: OnSuccess,
               error: OnError

           });

       }

       //var roleId;
       function OnSuccess(response, status) {
           var roleId;
           alert("success here")
           alert(response);
           
       }

       function OnError(request, status, error) {
           alert("error here");
           alert(JSON.stringify(request));
           alert(JSON.stringify(error));
           $("#lblData").html(request.statusText);
       }
       
           /* Test Gadgets API */
    function submitGetRole() {
            var params = {};
            params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;
            params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.GET;
            
            var inputParam = {};
            inputParam.name = $.trim($("[id*=searchRoleParam]").val());    
            var url = urlAPIRole + "?q=(name==" + inputParam.name  + ")&SabaCertificate=" + sabaCertificate;
            gadgets.io.makeRequest(url, role2Response, params);
        } 

        function role2Response(obj) {
            // Reference: https://developers.google.com/gadgets/docs/remote-content
            //  obj.data : <parsed data, if applicable>
            //  obj.errors : <any errors that occurred>
            //  obj.text : <raw text of the response>
            console.log(obj.data);
			console.log(obj.errors);
			console.log(obj.text);
			if (obj.data)
			{
				objJSON = JSON.parse(obj.data);
				var counter = objJSON.totalResults;
				for (j = 0 ; j < counter ; j++) {
                    roleId = objJSON.results[j].id
                   alert("roleID=" + roleId);
               }
			}
            alert("roleID=" + roleId);
			
			
        } 
       
      
      

    </script>

    <script type="text/os-template">
    <!-- Header of the Page Start -->
    
    <!-- Header of the Page END-->

    <!-- Search Box Start-->
    <div id="divRoleForm">
        <div>
            <center>
                <table border="10" cellpadding="10" cellspacing="10" >
                    <tr>
                        <td align="center"  style="font-weight:bold;">
                                                    
                            Please Enter Your Initiative/ Progarm Code ********
							</td>
                    </tr>
                    <tr>                            
                            <td align="center" >
                                <input type="text" id="searchRoleParam" size="40">
                            </td>
                    </tr>
                    <tr>
                        <td>
                            <table align="center">
                                <tr>
                                    <td align="center">
                                        <input type="button" id="btnRoleSubmit" value="Submit">&nbsp;&nbsp;&nbsp;&nbsp;                                    
                                        <input type="button" id="btnRoleCancel" value="Cancel">
				 <input type="lable" id="labelAPI" value="">
                                    </td>
                                </tr>
                            </table>
                        </td>

                    </tr>
                </table>
            </center>

        </div>

    </div>
    <!-- Search Box Start-->

    <!-- Employee Confirms Previous Box Start-->
    <div id="divConfirmPreviou" style="display:none">
        <div>
            <center>
                <table border="10" cellpadding="10" cellspacing="10">
                    <tr>
                        <td align="center" style="font-weight:bold;">

                            Profile Details
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <table align="center">
                                <tr>
                                    <td align="center">
                                        <input type="button" id="btnRoleConfrim" value="Confirm">&nbsp;&nbsp;&nbsp;&nbsp;
                                        <input type="button" id="btnRoleBack" value="Back">
                                    </td>
                                </tr>
                            </table>
                        </td>

                    </tr>
                </table>
            </center>

        </div>

    </div>
    </script>

  ]]>
  </Content>
</Module>
